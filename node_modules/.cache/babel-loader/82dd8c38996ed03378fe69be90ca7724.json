{"ast":null,"code":"import _defineProperty from \"/Users/weihangzhang/Documents/webpage/gosling-react/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport { hasOwnProperty, isArray } from 'vega-util';\nimport { hasConditionalFieldOrDatumDef, isConditionalDef, isFieldDef, isFieldOrDatumDef, isRepeatRef, isSortableFieldDef } from '../channeldef';\nimport * as log from '../log';\nimport { isSortField } from '../sort';\nimport { isFacetMapping } from '../spec/facet';\nexport function replaceRepeaterInFacet(facet, repeater) {\n  if (!repeater) {\n    return facet;\n  }\n  if (isFacetMapping(facet)) {\n    return replaceRepeaterInMapping(facet, repeater);\n  }\n  return replaceRepeaterInFieldDef(facet, repeater);\n}\nexport function replaceRepeaterInEncoding(encoding, repeater) {\n  if (!repeater) {\n    return encoding;\n  }\n  return replaceRepeaterInMapping(encoding, repeater);\n}\n/**\n * Replaces repeated value and returns if the repeated value is valid.\n */\nfunction replaceRepeatInProp(prop, o, repeater) {\n  var val = o[prop];\n  if (isRepeatRef(val)) {\n    if (val.repeat in repeater) {\n      return Object.assign(Object.assign({}, o), _defineProperty({}, prop, repeater[val.repeat]));\n    } else {\n      log.warn(log.message.noSuchRepeatedValue(val.repeat));\n      return undefined;\n    }\n  }\n  return o;\n}\n/**\n * Replace repeater values in a field def with the concrete field name.\n */\nfunction replaceRepeaterInFieldDef(fieldDef, repeater) {\n  fieldDef = replaceRepeatInProp('field', fieldDef, repeater);\n  if (fieldDef === undefined) {\n    // the field def should be ignored\n    return undefined;\n  } else if (fieldDef === null) {\n    return null;\n  }\n  if (isSortableFieldDef(fieldDef) && isSortField(fieldDef.sort)) {\n    var sort = replaceRepeatInProp('field', fieldDef.sort, repeater);\n    fieldDef = Object.assign(Object.assign({}, fieldDef), sort ? {\n      sort: sort\n    } : {});\n  }\n  return fieldDef;\n}\nfunction replaceRepeaterInFieldOrDatumDef(def, repeater) {\n  if (isFieldDef(def)) {\n    return replaceRepeaterInFieldDef(def, repeater);\n  } else {\n    var datumDef = replaceRepeatInProp('datum', def, repeater);\n    if (datumDef !== def && !datumDef.type) {\n      datumDef.type = 'nominal';\n    }\n    return datumDef;\n  }\n}\nfunction replaceRepeaterInChannelDef(channelDef, repeater) {\n  if (isFieldOrDatumDef(channelDef)) {\n    var fd = replaceRepeaterInFieldOrDatumDef(channelDef, repeater);\n    if (fd) {\n      return fd;\n    } else if (isConditionalDef(channelDef)) {\n      return {\n        condition: channelDef.condition\n      };\n    }\n  } else {\n    if (hasConditionalFieldOrDatumDef(channelDef)) {\n      var _fd = replaceRepeaterInFieldOrDatumDef(channelDef.condition, repeater);\n      if (_fd) {\n        return Object.assign(Object.assign({}, channelDef), {\n          condition: _fd\n        });\n      } else {\n        var condition = channelDef.condition,\n          channelDefWithoutCondition = __rest(channelDef, [\"condition\"]);\n        return channelDefWithoutCondition;\n      }\n    }\n    return channelDef;\n  }\n  return undefined;\n}\nfunction replaceRepeaterInMapping(mapping, repeater) {\n  var out = {};\n  for (var channel in mapping) {\n    if (hasOwnProperty(mapping, channel)) {\n      var channelDef = mapping[channel];\n      if (isArray(channelDef)) {\n        // array cannot have condition\n        out[channel] = channelDef // somehow we need to cast it here\n        .map(function (cd) {\n          return replaceRepeaterInChannelDef(cd, repeater);\n        }).filter(function (cd) {\n          return cd;\n        });\n      } else {\n        var cd = replaceRepeaterInChannelDef(channelDef, repeater);\n        if (cd !== undefined) {\n          out[channel] = cd;\n        }\n      }\n    }\n  }\n  return out;\n}","map":{"version":3,"sources":["../../../src/normalize/repeater.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { hasOwnProperty, isArray } from 'vega-util';\nimport { hasConditionalFieldOrDatumDef, isConditionalDef, isFieldDef, isFieldOrDatumDef, isRepeatRef, isSortableFieldDef } from '../channeldef';\nimport * as log from '../log';\nimport { isSortField } from '../sort';\nimport { isFacetMapping } from '../spec/facet';\nexport function replaceRepeaterInFacet(facet, repeater) {\n    if (!repeater) {\n        return facet;\n    }\n    if (isFacetMapping(facet)) {\n        return replaceRepeaterInMapping(facet, repeater);\n    }\n    return replaceRepeaterInFieldDef(facet, repeater);\n}\nexport function replaceRepeaterInEncoding(encoding, repeater) {\n    if (!repeater) {\n        return encoding;\n    }\n    return replaceRepeaterInMapping(encoding, repeater);\n}\n/**\n * Replaces repeated value and returns if the repeated value is valid.\n */\nfunction replaceRepeatInProp(prop, o, repeater) {\n    const val = o[prop];\n    if (isRepeatRef(val)) {\n        if (val.repeat in repeater) {\n            return Object.assign(Object.assign({}, o), { [prop]: repeater[val.repeat] });\n        }\n        else {\n            log.warn(log.message.noSuchRepeatedValue(val.repeat));\n            return undefined;\n        }\n    }\n    return o;\n}\n/**\n * Replace repeater values in a field def with the concrete field name.\n */\nfunction replaceRepeaterInFieldDef(fieldDef, repeater) {\n    fieldDef = replaceRepeatInProp('field', fieldDef, repeater);\n    if (fieldDef === undefined) {\n        // the field def should be ignored\n        return undefined;\n    }\n    else if (fieldDef === null) {\n        return null;\n    }\n    if (isSortableFieldDef(fieldDef) && isSortField(fieldDef.sort)) {\n        const sort = replaceRepeatInProp('field', fieldDef.sort, repeater);\n        fieldDef = Object.assign(Object.assign({}, fieldDef), (sort ? { sort } : {}));\n    }\n    return fieldDef;\n}\nfunction replaceRepeaterInFieldOrDatumDef(def, repeater) {\n    if (isFieldDef(def)) {\n        return replaceRepeaterInFieldDef(def, repeater);\n    }\n    else {\n        const datumDef = replaceRepeatInProp('datum', def, repeater);\n        if (datumDef !== def && !datumDef.type) {\n            datumDef.type = 'nominal';\n        }\n        return datumDef;\n    }\n}\nfunction replaceRepeaterInChannelDef(channelDef, repeater) {\n    if (isFieldOrDatumDef(channelDef)) {\n        const fd = replaceRepeaterInFieldOrDatumDef(channelDef, repeater);\n        if (fd) {\n            return fd;\n        }\n        else if (isConditionalDef(channelDef)) {\n            return { condition: channelDef.condition };\n        }\n    }\n    else {\n        if (hasConditionalFieldOrDatumDef(channelDef)) {\n            const fd = replaceRepeaterInFieldOrDatumDef(channelDef.condition, repeater);\n            if (fd) {\n                return Object.assign(Object.assign({}, channelDef), { condition: fd });\n            }\n            else {\n                const { condition } = channelDef, channelDefWithoutCondition = __rest(channelDef, [\"condition\"]);\n                return channelDefWithoutCondition;\n            }\n        }\n        return channelDef;\n    }\n    return undefined;\n}\nfunction replaceRepeaterInMapping(mapping, repeater) {\n    const out = {};\n    for (const channel in mapping) {\n        if (hasOwnProperty(mapping, channel)) {\n            const channelDef = mapping[channel];\n            if (isArray(channelDef)) {\n                // array cannot have condition\n                out[channel] = channelDef // somehow we need to cast it here\n                    .map(cd => replaceRepeaterInChannelDef(cd, repeater))\n                    .filter(cd => cd);\n            }\n            else {\n                const cd = replaceRepeaterInChannelDef(channelDef, repeater);\n                if (cd !== undefined) {\n                    out[channel] = cd;\n                }\n            }\n        }\n    }\n    return out;\n}\n//# sourceMappingURL=repeater.js.map"]},"metadata":{},"sourceType":"module"}