{"ast":null,"code":"import _createForOfIteratorHelper from \"/Users/weihangzhang/Documents/webpage/gosling-react/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _classCallCheck from \"/Users/weihangzhang/Documents/webpage/gosling-react/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/weihangzhang/Documents/webpage/gosling-react/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _assertThisInitialized from \"/Users/weihangzhang/Documents/webpage/gosling-react/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _get from \"/Users/weihangzhang/Documents/webpage/gosling-react/node_modules/@babel/runtime/helpers/esm/get.js\";\nimport _getPrototypeOf from \"/Users/weihangzhang/Documents/webpage/gosling-react/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";\nimport _inherits from \"/Users/weihangzhang/Documents/webpage/gosling-react/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/weihangzhang/Documents/webpage/gosling-react/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport { array } from 'vega-util';\nimport * as log from '../log';\nimport { isLayerSpec, isUnitSpec } from '../spec';\nimport { keys } from '../util';\nimport { assembleAxisSignals } from './axis/assemble';\nimport { parseLayerAxes } from './axis/parse';\nimport { parseData as _parseData } from './data/parse';\nimport { assembleLayoutSignals as _assembleLayoutSignals } from './layoutsize/assemble';\nimport { parseLayerLayoutSize } from './layoutsize/parse';\nimport { assembleLegends as _assembleLegends } from './legend/assemble';\nimport { Model } from './model';\nimport { assembleLayerSelectionMarks } from './selection/assemble';\nimport { UnitModel } from './unit';\nexport var LayerModel = /*#__PURE__*/function (_Model) {\n  _inherits(LayerModel, _Model);\n  var _super = _createSuper(LayerModel);\n  function LayerModel(spec, parent, parentGivenName, parentGivenSize, config) {\n    var _this;\n    _classCallCheck(this, LayerModel);\n    _this = _super.call(this, spec, 'layer', parent, parentGivenName, config, spec.resolve, spec.view);\n    var layoutSize = Object.assign(Object.assign(Object.assign({}, parentGivenSize), spec.width ? {\n      width: spec.width\n    } : {}), spec.height ? {\n      height: spec.height\n    } : {});\n    _this.children = spec.layer.map(function (layer, i) {\n      if (isLayerSpec(layer)) {\n        return new LayerModel(layer, _assertThisInitialized(_this), _this.getName(\"layer_\".concat(i)), layoutSize, config);\n      } else if (isUnitSpec(layer)) {\n        return new UnitModel(layer, _assertThisInitialized(_this), _this.getName(\"layer_\".concat(i)), layoutSize, config);\n      }\n      throw new Error(log.message.invalidSpec(layer));\n    });\n    return _this;\n  }\n  _createClass(LayerModel, [{\n    key: \"parseData\",\n    value: function parseData() {\n      this.component.data = _parseData(this);\n      var _iterator = _createForOfIteratorHelper(this.children),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var child = _step.value;\n          child.parseData();\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    }\n  }, {\n    key: \"parseLayoutSize\",\n    value: function parseLayoutSize() {\n      parseLayerLayoutSize(this);\n    }\n  }, {\n    key: \"parseSelections\",\n    value: function parseSelections() {\n      // Merge selections up the hierarchy so that they may be referenced\n      // across unit specs. Persist their definitions within each child\n      // to assemble signals which remain within output Vega unit groups.\n      this.component.selection = {};\n      var _iterator2 = _createForOfIteratorHelper(this.children),\n        _step2;\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var child = _step2.value;\n          child.parseSelections();\n          var _iterator3 = _createForOfIteratorHelper(keys(child.component.selection)),\n            _step3;\n          try {\n            for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n              var key = _step3.value;\n              this.component.selection[key] = child.component.selection[key];\n            }\n          } catch (err) {\n            _iterator3.e(err);\n          } finally {\n            _iterator3.f();\n          }\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n    }\n  }, {\n    key: \"parseMarkGroup\",\n    value: function parseMarkGroup() {\n      var _iterator4 = _createForOfIteratorHelper(this.children),\n        _step4;\n      try {\n        for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n          var child = _step4.value;\n          child.parseMarkGroup();\n        }\n      } catch (err) {\n        _iterator4.e(err);\n      } finally {\n        _iterator4.f();\n      }\n    }\n  }, {\n    key: \"parseAxesAndHeaders\",\n    value: function parseAxesAndHeaders() {\n      parseLayerAxes(this);\n    }\n  }, {\n    key: \"assembleSelectionTopLevelSignals\",\n    value: function assembleSelectionTopLevelSignals(signals) {\n      return this.children.reduce(function (sg, child) {\n        return child.assembleSelectionTopLevelSignals(sg);\n      }, signals);\n    }\n    // TODO: Support same named selections across children.\n  }, {\n    key: \"assembleSignals\",\n    value: function assembleSignals() {\n      return this.children.reduce(function (signals, child) {\n        return signals.concat(child.assembleSignals());\n      }, assembleAxisSignals(this));\n    }\n  }, {\n    key: \"assembleLayoutSignals\",\n    value: function assembleLayoutSignals() {\n      return this.children.reduce(function (signals, child) {\n        return signals.concat(child.assembleLayoutSignals());\n      }, _assembleLayoutSignals(this));\n    }\n  }, {\n    key: \"assembleSelectionData\",\n    value: function assembleSelectionData(data) {\n      return this.children.reduce(function (db, child) {\n        return child.assembleSelectionData(db);\n      }, data);\n    }\n  }, {\n    key: \"assembleGroupStyle\",\n    value: function assembleGroupStyle() {\n      var uniqueStyles = new Set();\n      var _iterator5 = _createForOfIteratorHelper(this.children),\n        _step5;\n      try {\n        for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n          var child = _step5.value;\n          var _iterator6 = _createForOfIteratorHelper(array(child.assembleGroupStyle())),\n            _step6;\n          try {\n            for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {\n              var style = _step6.value;\n              uniqueStyles.add(style);\n            }\n          } catch (err) {\n            _iterator6.e(err);\n          } finally {\n            _iterator6.f();\n          }\n        }\n      } catch (err) {\n        _iterator5.e(err);\n      } finally {\n        _iterator5.f();\n      }\n      var styles = Array.from(uniqueStyles);\n      return styles.length > 1 ? styles : styles.length === 1 ? styles[0] : undefined;\n    }\n  }, {\n    key: \"assembleTitle\",\n    value: function assembleTitle() {\n      var title = _get(_getPrototypeOf(LayerModel.prototype), \"assembleTitle\", this).call(this);\n      if (title) {\n        return title;\n      }\n      // If title does not provide layer, look into children\n      var _iterator7 = _createForOfIteratorHelper(this.children),\n        _step7;\n      try {\n        for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {\n          var child = _step7.value;\n          title = child.assembleTitle();\n          if (title) {\n            return title;\n          }\n        }\n      } catch (err) {\n        _iterator7.e(err);\n      } finally {\n        _iterator7.f();\n      }\n      return undefined;\n    }\n  }, {\n    key: \"assembleLayout\",\n    value: function assembleLayout() {\n      return null;\n    }\n  }, {\n    key: \"assembleMarks\",\n    value: function assembleMarks() {\n      return assembleLayerSelectionMarks(this, this.children.flatMap(function (child) {\n        return child.assembleMarks();\n      }));\n    }\n  }, {\n    key: \"assembleLegends\",\n    value: function assembleLegends() {\n      return this.children.reduce(function (legends, child) {\n        return legends.concat(child.assembleLegends());\n      }, _assembleLegends(this));\n    }\n  }]);\n  return LayerModel;\n}(Model);","map":{"version":3,"sources":["../../../src/compile/layer.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { array } from 'vega-util';\nimport * as log from '../log';\nimport { isLayerSpec, isUnitSpec } from '../spec';\nimport { keys } from '../util';\nimport { assembleAxisSignals } from './axis/assemble';\nimport { parseLayerAxes } from './axis/parse';\nimport { parseData } from './data/parse';\nimport { assembleLayoutSignals } from './layoutsize/assemble';\nimport { parseLayerLayoutSize } from './layoutsize/parse';\nimport { assembleLegends } from './legend/assemble';\nimport { Model } from './model';\nimport { assembleLayerSelectionMarks } from './selection/assemble';\nimport { UnitModel } from './unit';\nexport class LayerModel extends Model {\n    constructor(spec, parent, parentGivenName, parentGivenSize, config) {\n        super(spec, 'layer', parent, parentGivenName, config, spec.resolve, spec.view);\n        const layoutSize = Object.assign(Object.assign(Object.assign({}, parentGivenSize), (spec.width ? { width: spec.width } : {})), (spec.height ? { height: spec.height } : {}));\n        this.children = spec.layer.map((layer, i) => {\n            if (isLayerSpec(layer)) {\n                return new LayerModel(layer, this, this.getName(`layer_${i}`), layoutSize, config);\n            }\n            else if (isUnitSpec(layer)) {\n                return new UnitModel(layer, this, this.getName(`layer_${i}`), layoutSize, config);\n            }\n            throw new Error(log.message.invalidSpec(layer));\n        });\n    }\n    parseData() {\n        this.component.data = parseData(this);\n        for (const child of this.children) {\n            child.parseData();\n        }\n    }\n    parseLayoutSize() {\n        parseLayerLayoutSize(this);\n    }\n    parseSelections() {\n        // Merge selections up the hierarchy so that they may be referenced\n        // across unit specs. Persist their definitions within each child\n        // to assemble signals which remain within output Vega unit groups.\n        this.component.selection = {};\n        for (const child of this.children) {\n            child.parseSelections();\n            for (const key of keys(child.component.selection)) {\n                this.component.selection[key] = child.component.selection[key];\n            }\n        }\n    }\n    parseMarkGroup() {\n        for (const child of this.children) {\n            child.parseMarkGroup();\n        }\n    }\n    parseAxesAndHeaders() {\n        parseLayerAxes(this);\n    }\n    assembleSelectionTopLevelSignals(signals) {\n        return this.children.reduce((sg, child) => child.assembleSelectionTopLevelSignals(sg), signals);\n    }\n    // TODO: Support same named selections across children.\n    assembleSignals() {\n        return this.children.reduce((signals, child) => {\n            return signals.concat(child.assembleSignals());\n        }, assembleAxisSignals(this));\n    }\n    assembleLayoutSignals() {\n        return this.children.reduce((signals, child) => {\n            return signals.concat(child.assembleLayoutSignals());\n        }, assembleLayoutSignals(this));\n    }\n    assembleSelectionData(data) {\n        return this.children.reduce((db, child) => child.assembleSelectionData(db), data);\n    }\n    assembleGroupStyle() {\n        const uniqueStyles = new Set();\n        for (const child of this.children) {\n            for (const style of array(child.assembleGroupStyle())) {\n                uniqueStyles.add(style);\n            }\n        }\n        const styles = Array.from(uniqueStyles);\n        return styles.length > 1 ? styles : styles.length === 1 ? styles[0] : undefined;\n    }\n    assembleTitle() {\n        let title = super.assembleTitle();\n        if (title) {\n            return title;\n        }\n        // If title does not provide layer, look into children\n        for (const child of this.children) {\n            title = child.assembleTitle();\n            if (title) {\n                return title;\n            }\n        }\n        return undefined;\n    }\n    assembleLayout() {\n        return null;\n    }\n    assembleMarks() {\n        return assembleLayerSelectionMarks(this, this.children.flatMap(child => {\n            return child.assembleMarks();\n        }));\n    }\n    assembleLegends() {\n        return this.children.reduce((legends, child) => {\n            return legends.concat(child.assembleLegends());\n        }, assembleLegends(this));\n    }\n}\n//# sourceMappingURL=layer.js.map"]},"metadata":{},"sourceType":"module"}